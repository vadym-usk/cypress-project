name: Run Cypress in Docker

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  cypress-tests:
    runs-on: ubuntu-latest

    steps:
      # üß± –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout code
        uses: actions/checkout@v3

      # üê≥ –õ–æ–≥–∏–Ω –≤ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—Ä–∏–≤–∞—Ç–Ω—ã–π registry)
      # - name: Login to DockerHub
      #   run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin

      # üîß –°–æ–±–∏—Ä–∞–µ–º Docker image
      - name: Build Docker Image
        run: docker build -t cypress-tests .

      # üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      - name: Run Cypress Tests in Docker
        run: |
          docker run --name cypress-runner \
            -v ${{ github.workspace }}/cypress-reports:/app/cypress/reports \
            cypress-tests

      # üìé –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á—ë—Ç –∫–∞–∫ artifact
      - name: Upload HTML Report
        uses: actions/upload-artifact@v3.1.3
        with:
          name: cypress-report
          path: cypress-reports/index.html
